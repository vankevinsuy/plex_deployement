docker-compose --env-file ../.env up -d --build

kubectl delete namespace plexserver
kind delete clusters homelab

kind create cluster --config kind_homelab_cluster.yml

kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
kubectl wait --namespace ingress-nginx --for=condition=ready pod --selector=app.kubernetes.io/component=controller --timeout=90s

kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.7/config/manifests/metallb-native.yaml
kubectl wait --namespace metallb-system --for=condition=ready pod --selector=app=metallb --timeout=90s
kubectl apply -f https://kind.sigs.k8s.io/examples/loadbalancer/metallb-config.yaml


kubectl apply -f deploy_plex.yml

kubectl get pods -n plexserver
kubectl get svc -n plexserver
kubectl port-forward service/plex-tcp -n plexserver 32400:32400